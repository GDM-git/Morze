package MorzePack;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileWriter;
import java.io.IOException;
import java.util.HashSet;
import java.util.Properties;
import java.util.Scanner;

public class Coder_Morze_to_English implements Coder {

    public void coding(String File_in_name, String File_out_name, HashSet Char_list) throws IOException {
        System.out.println("Morze_to_English");
        //Подключаем пропертЮ
        Properties Decode = new Properties();
        FileInputStream in2 = new FileInputStream("Decode2.properties");
        Decode.load(in2);
        //Проверка файла, с которого производится ввод
        File File_in = new File(File_in_name);
        if (File_in.exists() == false) {
            throw null;
        }
        //Обновление файла для вывода
        File File_out = new File(File_out_name);
        if (File_out.exists()) {
            File_out.delete();
        }
        File_out.createNewFile();
        //Подключаем читателя и писателя
        FileWriter writer = new FileWriter(File_out);
        Scanner scan = new Scanner(File_in);
        //Здесь будет хранится текущая обрабатываемая строка
        StringBuilder Read_str = new StringBuilder();
        //Счетчик ошибок
        int k = 0;
        try {
            //Читаем первую строку
            Read_str.append(scan.nextLine());
            while (true) {
                //Переменная, которая будет определять место до которого мы добрались
                int j = 0;
                //Записываем первую строку в виде текста
                for (int i = 0; i < Read_str.length(); i++) {
                    try {
                        if (Read_str.charAt(i) == ' ') {
                            if (i != j) {
                                writer.write((String)Decode.get(Read_str.substring(j, i)));
                                Counter count = new Counter(((String) Decode.get(Read_str.substring(j, i))).charAt(0));
                                Char_list.add(count);
                                j = i + 1;
                            }
                            else {
                                writer.write(" ");
                                j = i + 1;
                                Counter count = new Counter(' ');
                                Char_list.add(count);
                            }
                        }
                    }
                    catch (Throwable My_ex) {
                        if (k == 0) {
                            System.out.print(My_ex.getMessage() + " - ");
                        }
                        k++;
                        j = i + 1;
                    }
                }
                //Сохраняем
                writer.flush();
                //Чистим StringBuilder и читаем следущую строку
                Read_str.delete(0, Read_str.length());
                Read_str.append(scan.nextLine());
                writer.write("\n");
            }
        }
        catch(Throwable My_ex){
            if (k != 0) {
                System.out.print(k + "\n");
            }
            System.out.println(My_ex.getMessage());
        }
    }
}
